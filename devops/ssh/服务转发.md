# 服务转发

## 说明

用于转发服务，需要用 ssh-add 先添加 key

## 用法

### 本地隧道

把远程服务，变为本机服务

必须要在 LOCAL_IP 的机器上执行

本机访问 VPS 做免密

```sh
ssh -NL $LOCAL_IP:$LOCAL_PORT:$REMOTE_IP:$REMOTE_PORT root@VPS
```

```sh
autossh -M 0 \
  -o "StrictHostKeyChecking no" \
  -o "ServerAliveInterval 30" \
  -CfNg -L $LOCAL_IP:$LOCAL_PORT:$REMOTE_IP:$REMOTE_PORT \
  root@$VPS
```

### 远程隧道

把本地局域网的服务，变为远程服务器的服务

执行的机器访问 VPS 做免密

```sh
# VPS 的 /etc/ssh/sshd_config
# GatewayPorts yes
# 0.0.0.0 为远程服务器的监听端口
ssh -NR 0.0.0.0:$REMOTE_PORT:$LAN_SERVER_IP:$LAN_SERVER_PORT root@REMOTE_IP
```

```sh
autossh -M 0 \
  -o "StrictHostKeyChecking no" \
  -o "ServerAliveInterval 30" \
  -CfNg -R 0.0.0.0:$REMOTE_PORT:$LAN_SERVER_IP:$LAN_SERVER_PORT \
  root@REMOTE_IP
```
