# 域名白名单

## 例子

nginx.conf

```conf
include /etc/nginx/conf.d/https.conf;
include /etc/nginx/conf.d/http.conf;
```

http.conf

```conf
geo $is_internal {
    default false;
    192.168.0.0/16 true;
    172.16.0.0/12 true;
    10.0.0.0/8 true;
}

# 判断内外网
server {
    listen 80 default_server;
    server_name _;

    include /etc/nginx/conf.d/office.conf;
    include /etc/nginx/conf.d/business.conf;

    if ($is_internal = false) {
        return 444;
    }
}

# 域名匹配，跳转 https
server {
    listen 80;
    server_name aa.bbb.com;
    return 301 https://$host$request_uri;
}
```

https.conf

```conf
# 443 端口，非法域名直接断开
server{
  listen 443 default_server;
  server_name _;
  ssl_certificate     /usr/local/nginx/cert/$CRT_FILE;
  ssl_certificate_key /usr/local/nginx/cert/$KEY_FILE;
  access_log off;
  return 444;
}

# 443 端口，合法域名的业务
server {
    listen 443 ssl;

    server_name  $DOMAIN_NAME;

    ssl_certificate     /usr/local/nginx/cert/$CRT_FILE;
    ssl_certificate_key /usr/local/nginx/cert/$KEY_FILE;

    include /etc/nginx/conf.d/office.conf;
    include /etc/nginx/conf.d/business.conf;

    # 二次防护：确保 Host header 是合法域名
    if ($host != "$DOMAIN_NAME") {
        return 444;
    }
}
```
