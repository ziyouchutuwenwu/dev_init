# 拆分项目

## 说明

分两个项目

## 例子

duktape 为三方库

### 结构

```sh
├── demo
│   ├── build.zig
│   ├── build.zig.zon
│   └── src
│       ├── lib_wrapper
│       │   ├── js.c
│       │   └── js.h
│       ├── main.zig
│       └── root.zig
└── duktape
    ├── build.zig
    ├── build.zig.zon
    └── src
        ├── c
        │   ├── duk_config.h
        │   ├── duktape.c
        │   └── duktape.h
        └── lib.zig
```

### 三方库

lib.zig

```zig
comptime {
    _ = @cImport({
        @cInclude("duktape.h");
    });
}
```

build.zig

```zig
const lib_mod = b.createModule(.{
    .root_source_file = b.path("src/lib.zig"),
    .target = target,
    .optimize = optimize,
});

const lib = b.addLibrary(.{
    .name = "duktape",
    .root_module = lib_mod,
    .linkage = .static,
});

lib.addIncludePath(b.path("src/c"));
lib.addCSourceFile(.{
    .file = b.path("src/c/duktape.c"),
    .flags = &[_][]const u8{"-std=c99"},
});
lib.linkLibC();

// 复制头文件
lib.installHeadersDirectory(b.path("src/c"), ".", .{});
// lib.installHeader(b.path("src/c/duktape.h"), "duktape.h");
// lib.installHeader(b.path("src/c/duk_config.h"), "duk_config.h");

b.installArtifact(lib);
```

### 应用

js.h

```h
#pragma once

void demo();
```

js.c

```c
#include "js.h"
#include "duktape.h"

void demo() {
  duk_context *ctx = duk_create_heap_default();
  duk_eval_string(ctx, "1+2");
  printf("1+2=%d\n", (int) duk_get_int(ctx, -1));
  duk_destroy_heap(ctx);
}
```

build.zig

```zig
// 依赖库所需
const local_dep = b.dependency("duktape", .{
    .target = target,
    .optimize = optimize,
});
const duktape_lib = local_dep.artifact("duktape");
exe.addIncludePath(local_dep.path("include"));
exe.linkLibrary(duktape_lib);

// 依赖库封装
exe.addIncludePath(b.path("src/lib_wrapper"));
exe.addCSourceFiles(.{
    .root = b.path("src"),
    .files = &.{"lib_wrapper/js.c"},
});

// main.zig 里面 import
exe.addIncludePath(b.path("src"));

b.installArtifact(exe);
```
