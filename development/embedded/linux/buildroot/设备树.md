# 设备树

## 说明

linux 内核自带设备树的路径，build 以后才能看到

```sh
output/build/linux-*/arch/arm/boot/dts/
```

## 准备工作

```sh
make O=output menuconfig
```

```sh
# 启用设备树
Kernel  --->
  [*]   Build a Device Tree Blob (DTB)
  (board/demo_vendor/demo_board/dts) Out-of-tree Device Tree Source overlay directories
```

## 例子

推荐方案 2

### 方案1

源码下，准备目录

```sh
board/demo_vendor
└── demo_board
    ├── demo_board.defconfig
    └── dts
        └── demo_board.dts
```

demo_board.dts

```dts
/dts-v1/;

#include "arm/vexpress-v2p-ca9.dts"

/ {
    model = "demo board";
    compatible = "demo_vendor,demo_board";
};
```

make 会报错

```sh
make O=output linux-rebuild -j$(nproc)
```

手动处理

```sh
output/build/linux-*/arch/arm/boot/dts/Makefile
```

手动添加

```Makefile
dtb-y += \
  demo_board.dtb
```

重新 make

### 方案2

```sh
board/demo_vendor
└── demo_board
    ├── demo_board.defconfig
    └── dts
        └── demo_vendor
            └── demo_board.dts
```

demo_board.dts

```dts
/dts-v1/;

// 注意这里的路径
#include "../arm/vexpress-v2p-ca9.dts"

/ {
    model = "demo board";
    compatible = "demo_vendor,demo_board";
};
```

make 会报错

```sh
make O=output linux-rebuild -j$(nproc)
```

修改

```sh
output/build/linux-*/arch/arm/boot/dts/Makefile
```

添加

```Makefile
subdir-y += demo_vendor
```

```sh
output/build/linux-*/arch/arm/boot/dts/demo_vendor/Makefile
```

内容

```Makefile
dtb-y += \
  demo_board.dtb
```

重新 make
