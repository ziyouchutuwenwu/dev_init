# 环境配置

## 说明

目录结构

```sh
zephyr
├── sdk
├── repo
└── venv
```

## 步骤

### 准备

```sh
cmake wget ninja
```

### 虚拟环境

```sh
uv venv ./venv
source venv/bin/activate
uv pip install west

# 后面会用到的库
uv pip install jsonschema patool requests semver tqdm
```

### 源码包

```sh
cd repo

west init

# 断点续传
west update

# 全量下载
west update -f always

# 更换目录以后，也要手动运行
west zephyr-export
```

### sdk

自动

```sh
# 有的版本会在你指定的目录内再创建一个带版本号的子目录
# 和 repo 仓库的版本有关系
west sdk install --install-dir ~/dev/zephyr/sdk
```

手动

```sh
# 根据 ~/dev/zephyr/repo/zephyr/SDK_VERSION 确定版本
axel https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.17.4/zephyr-sdk-0.17.4_linux-x86_64.tar.xz

# 解压
cd sdk
./setup.sh -t all
```

env.sh

```sh
#!/usr/bin/env bash

ZEPHYR_ROOT="$HOME/dev/zephyr"
WORKSPACE="$ZEPHYR_ROOT/repo"

ORIGINAL_DIR="$(pwd)"

cd "$WORKSPACE" || return

source "$ZEPHYR_ROOT/venv/bin/activate"
source zephyr/zephyr-env.sh

export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
export ZEPHYR_SDK_INSTALL_DIR="$ZEPHYR_ROOT/sdk"

cd "$ORIGINAL_DIR"
```

### 测试

repo/zephyr/samples 里面找一个复制出来

```bash
source ~/dev/zephyr/env.sh

west build -b qemu_x86
west build -t run
```
