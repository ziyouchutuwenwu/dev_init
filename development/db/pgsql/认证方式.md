# 认证方式

## 说明

| 类型  | 数据库      | 用户     | IP / 地址范围    | 认证方式      | 解释                                                                | 存在方式 |
| ----- | ----------- | -------- | ---------------- | ------------- | ------------------------------------------------------------------- | -------- |
| local | all         | postgres |                  | peer          | peer 用系统用户名登陆，无需密码；系统用户名必须与数据库用户名一致。 |          |
| local | all         | all      |                  | scram-sha-256 | 本地 postgres 之外的账户，都用密码验证。                            | 手动添加 |
| host  | all         | all      | 0.0.0.0/0        | scram-sha-256 | 非本地的所有主机连接都用密码验证                                    | 手动添加 |
| host  | all         | all      | 127.0.0.1/32     | scram-sha-256 | 本地 ipv4 回环地址，用密码验证                                      |          |
| host  | all         | all      | ::1/128          | scram-sha-256 | 本地 ipv6 回环地址，用密码验证                                      |          |
| host  | replication | replica  | 192.168.xx.xx/32 | trust         | 内网某 ip 的流复制用户，完全信任                                    | 手动添加 |
| local | replication | all      |                  | peer          | 本地流复制用户，用系统用户名登陆，无需密码。                        |          |
| host  | replication | all      | 127.0.0.1/32     | scram-sha-256 | 本地 ipv4 回环地址的流复制用户，用密码验证                          |          |
| host  | replication | all      | ::1/128          | scram-sha-256 | 本地 ipv6 回环地址的流复制用户，用密码验证                          |          |

## 配置

pg_hba.conf

规则从上往下，顺序匹配，顺序很重要

```conf
# 本地 postgres 之外的账户，都用密码验证
local   all             all                                     scram-sha-256

# 非本地的所有主机连接都用密码验证
host    all             all             0.0.0.0/0               scram-sha-256



# 默认的认证配置


# 放在 replication 部分的第一行
host    replication     replica         xx.xx.xx.xx/32          trust
```
